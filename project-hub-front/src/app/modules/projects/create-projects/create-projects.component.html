


    <div class="card">
        <div class="flex flex-col items-center text-center">
            <div class="mb-4">
                <span class="block">
                    Welcome to the project creation page. Here you can create a new project!
                </span>
                <span class="block mt-2">
                    1. All Projects are based off information in the Repo. If something is missing, please add it to the repo then start making a new project.
                </span>
                <span class="block mt-2">
                    2. First it will ask for the basic project information. 
                </span>
                <span class="block mt-2">
                    3. Then it will have you confirm phase dates but these will be auto generated by default for each week. So be sure to verify those are right.
                </span>
                <span class="block mt-2">
                    4. Then you can choose your team members and assign them to the project resource. 
                </span>
                <span class="block mt-2">
                    5. Then you can choose your tasks, it will ask for task types, while the tasks with the type generic will be automatically added.
                </span>
                <span class="block mt-2">
                    6. Then you can choose your notebooks, you want to add.
                </span>
            </div>
            @if(!start) {
                <div class="mt-6">
                    <p-button (click)="startProjectForm()">Start</p-button>
                </div>
            }
            @if(start) {
                <div class="mt-6 animate-scalein">
                    <p-button (click)="resetForm()">Reset</p-button>
                </div>
            }
        </div>
    </div>

@if(start == true) {
    <div class="card animate-fadein">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div>
                <label for="name" class="block font-bold mb-2">Name</label>
                <input type="text" pInputText id="name" [(ngModel)]="project.name" class="w-full" required />
            </div>
            <div>
                <label for="description" class="block font-bold mb-2">Description</label>
                <textarea rows="3" pTextarea id="description" [(ngModel)]="project.description" class="w-full" required></textarea>
            </div>
            <div>
                <label for="startDate" class="block font-bold mb-2">Start Date</label>
                <input type="date" pInputText id="startDate" [value]="formatDateForInput(project.startDate)" (change)="updateProjectStartDate($event)" class="w-full" required />
            </div>
            <div>
                <label for="endDate" class="block font-bold mb-2">End Date</label>
                <input type="date" pInputText id="endDate" [value]="formatDateForInput(project.endDate)" (change)="updateProjectEndDate($event)" class="w-full" required />
            </div>
            <div>
                <label for="status" class="block font-bold mb-2">Status</label>
                <p-select [options]="status" optionLabel="label" optionValue="value" 
                           [(ngModel)]="project.status" class="w-full" required>
                </p-select>
            </div>
            <div>
                <label for="type" class="block font-bold mb-2">Type</label>
                <p-select [options]="type" optionLabel="label" optionValue="value" 
                           [(ngModel)]="project.type" class="w-full" required>
                </p-select>
            </div>
        </div>
        @if (projectFormInvalid) {
            <div class="text-center text-red-600 my-4">
                {{ projectFormErrorMessage }}
            </div>
        }
        <div class="mt-6">
            <p-button (click)="startPhaseForm()">Next</p-button>
        </div>
    </div>
}

@if(startPhase == true) {
    <div class="card animate-fadein">
        <span class="block font-bold mb-4 mt-5 text-center">Select Phases</span>
        <div class="mb-6 flex justify-center">
            <p-multiselect [options]="phaseRepoService.allPhases()" 
              [(ngModel)]="phasesSelected" 
              optionLabel="name" 
              (ngModelChange)="onPhaseSelectionChange($event)"
              class="w-full max-w-md mx-auto" 
              display="chip"
              required>
            </p-multiselect>
        </div>
        @if (phases.length === 0) {
            <div class="text-center text-amber-600 my-4">
                Please select at least one phase to continue.
            </div>
        }
        <p-divider />
    
        <!-- Phase dates in separate rows -->
        <div class="space-y-4">
            @for (phase of phases; track $index) {
                <span class="block font-bold mb-4 mt-5 text-center">Phase : {{ phase.order }}</span>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">                 
                    <div class="px-10">
                        <span class="block font-bold mb-4 mt-5">Start Date</span>
                        <input type="date" pInputText [value]="formatDateForInput(phase.startDate)" (change)="updatePhaseStartDate(phase, $event)" class="w-full" required />
                        <small class="text-sm text-blue-600 mt-1 block">{{ formatDate(phase.startDate) }}</small>
                    </div>
                    <div class="px-10 pb-5">
                        <span class="block font-bold mb-4 mt-5">End Date</span>
                        <input type="date" pInputText [value]="formatDateForInput(phase.endDate)" (change)="updatePhaseEndDate(phase, $event)" class="w-full" required />
                        <small class="text-sm text-blue-600 mt-1 block">{{ formatDate(phase.endDate) }}</small>
                    </div>
                </div>
                <p-divider />
            }
        </div>
        <div class="mt-6 flex justify-between">
            <p-button (click)="startPhaseForm()" severity="secondary">Back</p-button>
            <p-button (click)="startTaskForm()" [disabled]="phases.length === 0">Next</p-button>
        </div>
    </div>
}

@if(startTask == true) {
    <div class="card animate-fadein">
        <span class="block font-bold mb-4 mt-5 text-center">Select Task Types</span>
        <div class="mb-2 flex justify-center">
            <p-multiselect [options]="taskTypeRepoService.allTaskTypes()" 
              [(ngModel)]="selectedTaskTypes" 
              optionLabel="name" 
              (ngModelChange)="onTaskTypeSelectionChange($event)"
              class="w-full max-w-md mx-auto" 
              display="chip"
              required>
            </p-multiselect>
        </div>
        
        <div class="text-center text-sm text-gray-600 mb-4">
            Tasks will be assigned to phases based on their configured phase order.
        </div>
        
        @if (totalTasksSelected > 0) {
            <div class="text-center text-green-600 my-4">
                {{ totalTasksSelected }} tasks will be added to their respective phases.
            </div>
        } @else {
            <div class="text-center text-amber-600 my-4">
                Please select at least one task type to continue.
            </div>
        }
        
        <p-divider />
        
        @if (totalTasksSelected > 0) {
            <p-accordion>
                @for (phase of phases; track phase.order) {
                    <p-accordionTab header="Phase {{phase.order}}: {{phase.name}} ({{tasksToAdd[phase.order]?.length || 0}} tasks)">
                        <!-- Task Categories Section -->
                        @if (phase.projectTaskCategories && phase.projectTaskCategories.length > 0) {
                            <div class="mb-4">
                                <h4 class="text-lg font-semibold mb-2">Categories</h4>
                                <div class="flex flex-wrap gap-2">
                                    @for (category of phase.projectTaskCategories; track $index) {
                                        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">
                                            {{ category.name }}
                                        </span>
                                    }
                                </div>
                            </div>
                        }
                        
                        <!-- Tasks Section -->
                        <h4 class="text-lg font-semibold mb-2">Tasks</h4>
                        <div class="overflow-auto max-h-[400px]">
                            <ul class="space-y-2">
                                @for (task of tasksToAdd[phase.order]; track $index) {
                                    <li class="p-2 border border-gray-200 rounded" [ngClass]="{'border-amber-200 bg-amber-50': task.autoAssigned}">
                                        <div class="font-semibold">{{ task.name }}</div>
                                        <div class="text-sm text-gray-600">{{ task.description }}</div>
                                        @if (task.autoAssigned) {
                                            <div class="text-xs text-amber-600 mt-1">* Auto-assigned to this phase</div>
                                        }
                                    </li>
                                }
                            </ul>
                        </div>
                    </p-accordionTab>
                }
            </p-accordion>
        }
        
        <div class="mt-6 flex justify-between">
            <p-button (click)="startTaskForm()" severity="secondary">Back</p-button>
            <p-button (click)="startNotebookForm()" [disabled]="totalTasksSelected === 0">Next</p-button>
        </div>
    </div>
}

@if(startNotebook == true) {
    <div class="card animate-fadein">
        <span class="block font-bold mb-4 mt-5 text-center">Select Notebooks</span>
        <div class="mb-6 flex justify-center">
            <p-multiselect [options]="taskNotebookRepoService.allNotebooks()" 
              [(ngModel)]="selectedNotebooks" 
              optionLabel="name" 
              (ngModelChange)="onNotebookSelectionChange($event)"
              class="w-full max-w-md mx-auto" 
              display="chip">
            </p-multiselect>
        </div>
        
        @if (selectedNotebooks.length > 0) {
            <div class="text-center text-green-600 my-4">
                {{ selectedNotebooks.length }} notebooks selected
            </div>
            
            <p-divider />
            
            <div class="mt-4">
                <h4 class="text-lg font-semibold mb-4">Selected Notebooks</h4>
                <div class="overflow-auto max-h-[400px]">
                    <ul class="space-y-4">
                        @for (notebook of selectedNotebooks; track $index) {
                            <li class="p-4 border border-gray-200 rounded">
                                <div class="font-semibold text-lg">{{ notebook.name }}</div>
                                <div class="text-sm text-gray-600 mt-2">{{ notebook.description }}</div>
                                <div class="text-xs text-gray-500 mt-2 line-clamp-3">{{ notebook.content }}</div>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        } @else {
            <div class="text-center text-amber-600 my-4">
                No notebooks selected. You can continue without notebooks or select some from the list.
            </div>
        }
        
        <div class="mt-6 flex justify-between">
            <p-button (click)="startTaskForm()" severity="secondary">Back</p-button>
            <p-button (click)="submitProject()">Submit Project</p-button>
        </div>
    </div>
}


